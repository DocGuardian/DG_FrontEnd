<main class="w-full h-screen text-gray-900 flex flex-col space-y-5 p-6">
  <!-- Navbar -->

  <!-- Modal -->
  <div *ngIf="showModal" class="fixed inset-0 z-50 overflow-y-auto">
    <div
      class="flex items-end justify-center min-h-screen px-4 text-center md:items-center sm:block sm:p-0"
    >
      <div
        *ngIf="showModal"
        (click)="toggleModal()"
        class="fixed h-full w-full inset-0 flex items-center transition-opacity blur-sm backdrop-blur-sm bg-gray/10"
      ></div>

      <div
        *ngIf="showModal"
        class="inline-block w-full h-full my-auto md:my-[30vh] max-w-xl overflow-hidden text-left transition-all transform bg-white rounded-lg shadow-xl 2xl:max-w-2xl ring-1 ring-green-400"
      >
        <form
          id="searchUsers"
          [formGroup]="searchUsers"
          class="p-5 border-b border-gray-200"
        >
          <div class="poppins-regular flex gap-2 items-center justify-center">
            <input
              placeholder="Search user by email"
              required
              formControlName="email"
              name="email"
              class="block w-full px-3 py-2 text-gray-800 placeholder-gray-400 bg-white border border-gray-200 rounded-md focus:border-green-600 focus:outline-none focus:ring focus:ring-green-500 focus:ring-opacity-40"
            />

            <div
              (click)="onSearch()"
              class="flex items-center justify-center p-2 text-sm tracking-wide bg-green-400 text-white capitalize cursor-pointer transition-colors duration-100 transform rounded hover:shadow-lg ring-1 ring-green-600 hover:bg-green-700"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
                class="w-6 h-6"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"
                />
              </svg>
            </div>
          </div>
        </form>
        <div>
          <div
            class="poppins-regular max-h-56 h-auto p-4 flex flex-col gap-4 overflow-y-auto"
          >
            <p *ngIf="recipient?.email" class="poppins-regular">All Users</p>
            <p *ngIf="!isSearching" class="poppins-regular text-gray-500">
              Searching ...
            </p>

            <p *ngIf="search_res" class="poppins-regular text-gray-600">
              {{ search_res | lowercase }}
            </p>

            <div
              (click)="onInvite()"
              *ngIf="recipient?.email"
              class="flex gap-4 cursor-pointer rounded p-2 hover:bg-green-50"
            >
              <a
                routerLink="/dg/profile"
                aria-label="profile"
                class="flex items-center px-1 text-white"
              >
                <div class="flex items-center justify-center">
                  <img
                    class="w-10 h-10 mx-auto rounded-full border-2 border-green-400"
                    [src]="recipient?.imageUrl ?? './assets/person.png'"
                    alt=""
                  />
                </div>
              </a>
              <div class="flex flex-col">
                <span class="poppins-medium text-sm">
                  {{ recipient?.first_name }} {{ recipient?.last_name }}</span
                >
                <span class="poppins-regular text-gray-500 text-xs">{{
                  recipient?.email
                }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div
    *ngIf="showModal || showParticipants"
    class="opacity-25 fixed inset-0 z-40 bg-black"
  ></div>
  <!-- End Modal -->

  <!-- Participants Model -->
  <div *ngIf="showParticipants" class="fixed inset-0 z-50 overflow-y-auto">
    <div
      class="flex items-end justify-center min-h-screen px-4 text-center md:items-center sm:block sm:p-0"
    >
      <div
        *ngIf="showParticipants"
        (click)="toggleParticipants()"
        class="fixed h-full w-full inset-0 flex items-center transition-opacity blur-sm backdrop-blur-sm bg-gray/10"
      ></div>

      <div
        *ngIf="showParticipants"
        class="inline-block w-full h-full my-auto md:my-[20vh] max-w-xl overflow-hidden text-left transition-all transform bg-white rounded-lg shadow-xl 2xl:max-w-2xl ring-1 ring-green-400"
      >
        <div>
          <div
            class="flex flex-col justify-center items-center poppins-regular p-4 gap-4 overflow-y-auto"
          >
            <p class="poppins-medium text-gray-900">Participants</p>
            <section class="flex flex-col w-full">
              <div
                class="flex flex-col gap-6 rounded-md border border-gray-200 p-4"
              >
                <div
                  *ngFor="let user of room.users"
                  class="w-full flex justify-between items-center gap-4 cursor-pointer rounded p-2 hover:bg-green-50"
                >
                  <div class="flex gap-4">
                    <div class="flex items-center text-white">
                      <div class="flex items-center justify-center">
                        <img
                          class="w-10 h-10 mx-auto rounded-full border-2 border-green-400"
                          [src]="user?.imageUrl ?? './assets/person.png'"
                          alt=""
                        />
                      </div>
                    </div>
                    <div class="flex flex-col justify-center">
                      <span class="poppins-medium text-sm">
                        {{ user?.first_name }}
                        {{ user?.last_name }}</span
                      >
                      <span class="poppins-regular text-gray-500 text-xs">{{
                        user?.email
                      }}</span>
                    </div>
                  </div>

                  <div *ngIf="user.id != room.owner.id && user.id != sender?.id" (click)="remove(user)">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 640 512"
                      class="h-6 w-6 fill-red-500"
                    >
                      <path
                        d="M96 128a128 128 0 1 1 256 0A128 128 0 1 1 96 128zM0 482.3C0 383.8 79.8 304 178.3 304h91.4C368.2 304 448 383.8 448 482.3c0 16.4-13.3 29.7-29.7 29.7H29.7C13.3 512 0 498.7 0 482.3zM472 200H616c13.3 0 24 10.7 24 24s-10.7 24-24 24H472c-13.3 0-24-10.7-24-24s10.7-24 24-24z"
                      />
                    </svg>
                  </div>
                </div>
              </div>
            </section>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- End -->

  <!-- Exit Confirm Model -->
  <div *ngIf="showRemove" class="fixed inset-0 z-50 overflow-y-auto">
    <div
      class="flex items-end justify-center min-h-screen px-4 text-center md:items-center sm:block sm:p-0"
    >
      <div
        *ngIf="showRemove"
        class="fixed h-full w-full inset-0 flex items-center transition-opacity blur-sm backdrop-blur-sm bg-gray/10"
      ></div>

      <div
        *ngIf="showRemove"
        class="inline-block w-full h-full my-auto md:my-[30vh] max-w-xl overflow-hidden text-left transition-all transform bg-white rounded-md shadow-xl 2xl:max-w-2xl ring-1 ring-green-200"
      >
        <div>
          <div
            class="flex flex-col justify-center poppins-regular p-4 gap-4 overflow-y-auto"
          >
            <p class="poppins-medium text-gray-900">Remove Participant</p>
            <p
              *ngIf="sender?.id != selectedUser?.id"
              class="poppins-regular text-gray-700"
            >
              Are sure you want to remove this user from your room ?
            </p>
            <p
              *ngIf="sender?.id == selectedUser?.id"
              class="poppins-regular text-gray-700"
            >
              Are sure you want to leave this room ?
            </p>

            <div class="flex justify-end w-full space-x-3">
              <a
                (click)="confirmRemove()"
                class="self-center poppins-regular px-5 p-1.5 bg-red-500 border border-red-400 rounded cursor-pointer"
              >
                <span class="text-white">Yes</span>
              </a>
              <a
                (click)="toggleRemove()"
                class="self-center poppins-regular px-5 p-1.5 border border-gray-400 rounded cursor-pointer"
              >
                <span class="text-gray-900">No</span>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- End -->

  <div class="flex flex-col sm:flex-row justify-between items-center">
    <p class="poppins-medium text-xl">
      {{ room?.name }}
    </p>
  </div>

  <section class="w-full text-gray-900 flex flex-col">
    <!-- Participants -->
    <div class="flex items-center space-x-2 p-4 border rounded-t-md">
      <p
        (click)="toggleParticipants()"
        class="poppins-regular text-white p-2 bg-gray-900 rounded cursor-pointer"
      >
        Participants
      </p>
      <div
        class="flex items-center space-x-2 overflow-x-scroll scrollbarHidden"
      >
        <img
          *ngFor="let user of room?.users"
          class="w-8 h-8 rounded-full object-cover bg-white cursor-pointer"
          [src]="user.imageUrl ?? './assets/person.png'"
          [alt]="user.first_name"
        />

        <div
          *ngIf="room.users.length > 2"
          class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center poppins-regular text-sm"
        >
          + {{ room.users.length - 2 }}
        </div>
      </div>
    </div>

    <section
      class="grid md:grid-cols-1 w-full h-[70vh] bg-gray-100 border rounded-es-md"
    >
      <!-- Docs -->
      <div
        class="flex flex-col bg-gray-100 h-full w-full justify-between rounded-ss-md overflow-hidden"
      >
        <div
          class="p-4 max-h-full w-full rounded-t overflow-y-scroll scrollbar"
        >
          <app-user-doc
            *ngFor="let doc of docs"
            [doc]="doc"
            [sender]="sender"
          ></app-user-doc>
        </div>

        <div class="bg-gray-100 p-3 w-full">
          <div
            class="flex p-2 justify-center items-center space-x-4 bg-white rounded"
          >
            <form
              [formGroup]="documentForm"
              enctype="multipart/form-data"
              id="documentForm"
              class="p-2 rounded-full bg-gray-800"
            >
              <label>
                <input
                  class="text-sm cursor-pointer hidden"
                  type="file"
                  formControlName="docUrl"
                  (change)="uploadFile($event)"
                  multiple
                />
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="fill-white w-6 h-6 cursor-pointer"
                  viewBox="0 0 640 512"
                >
                  <path
                    d="M144 480C64.5 480 0 415.5 0 336c0-62.8 40.2-116.2 96.2-135.9c-.1-2.7-.2-5.4-.2-8.1c0-88.4 71.6-160 160-160c59.3 0 111 32.2 138.7 80.2C409.9 102 428.3 96 448 96c53 0 96 43 96 96c0 12.2-2.3 23.8-6.4 34.6C596 238.4 640 290.1 640 352c0 70.7-57.3 128-128 128H144zm79-217c-9.4 9.4-9.4 24.6 0 33.9s24.6 9.4 33.9 0l39-39V392c0 13.3 10.7 24 24 24s24-10.7 24-24V257.9l39 39c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-80-80c-9.4-9.4-24.6-9.4-33.9 0l-80 80z"
                  />
                </svg>
              </label>
            </form>

            <div
              (click)="toggleModal()"
              class="p-2 rounded-full bg-green-200 cursor-pointer"
            >
              <svg
                class="fill-green-500 w-6 h-6 cursor-pointer"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 640 512"
              >
                <path
                  d="M96 128a128 128 0 1 1 256 0A128 128 0 1 1 96 128zM0 482.3C0 383.8 79.8 304 178.3 304h91.4C368.2 304 448 383.8 448 482.3c0 16.4-13.3 29.7-29.7 29.7H29.7C13.3 512 0 498.7 0 482.3zM504 312V248H440c-13.3 0-24-10.7-24-24s10.7-24 24-24h64V136c0-13.3 10.7-24 24-24s24 10.7 24 24v64h64c13.3 0 24 10.7 24 24s-10.7 24-24 24H552v64c0 13.3-10.7 24-24 24s-24-10.7-24-24z"
                />
              </svg>
            </div>
            <div
              (click)="exit()"
              class="p-2 rounded-full bg-red-200 cursor-pointer"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
                class="w-6 h-6 text-red-500"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15M12 9l-3 3m0 0l3 3m-3-3h12.75"
                />
              </svg>
            </div>
          </div>
        </div>
      </div>

      <!-- Chat -->
      <!-- <div
        class="hidden bg-gray-100 h-full w-full justify-between rounded-ss-md overflow-hidden md:flex md:flex-col"
      >
        <div class="p-4 max-h-full w-full rounded-t">
          <div class="w-full h-full rounded-se-md">
            <div class="flex flex-col w-full h-full rounded-md overflow-hidden">
              <div
                class="flex items-center justify-between bg-white p-3 shadow-sm border-b border-gray-200"
              >
                <p class="poppins-medium text-gray-600">Conversation</p>
              </div>

              <div
                id="Conversation"
                class="flex flex-col p-4 bg-white h-full overflow-y-scroll scrollbar"
              >
                <div class="flex items-center mb-2">
                  <img
                    class="w-10 h-10 rounded-full mr-2"
                    src="./assets/person.png"
                    alt="Avatar 1"
                  />
                  <div class="text-sm text-gray-700">
                    <p class="poppins-medium">John Doe</p>
                    <div
                      class="bg-gray-50 rounded-es-full rounded-r-full px-4 py-2 shadow-md"
                    >
                      <p class="poppins-regular text-sm text-gray-900">
                        Hi i am John.
                      </p>
                    </div>
                  </div>
                </div>

                <div class="flex items-center mb-2">
                  <img
                    class="w-10 h-10 rounded-full mr-2"
                    src="./assets/person.png"
                    alt="Avatar 1"
                  />
                  <div class="mt-2 text-sm text-gray-700">
                    <p class="poppins-medium">Hugo Abagnel</p>
                    <div
                      class="bg-gray-50 rounded-es-full rounded-r-full px-4 py-2 shadow-md"
                    >
                      <p class="poppins-regular text-sm text-gray-900">
                        Hi i am Hugo.
                      </p>
                    </div>
                  </div>
                </div>

                <div class="flex items-end justify-end mb-2">
                  <div class="text-sm text-gray-700 flex flex-col items-end">
                    <p class="poppins-medium">Abdelmalek Achkif</p>
                    <div
                      class="bg-green-400 rounded-ee-full rounded-l-full px-4 py-2 shadow-md"
                    >
                      <p class="poppins-regular text-sm text-gray-900">
                        Hi John How are you.
                      </p>
                    </div>
                  </div>
                  <img
                    class="w-10 h-10 rounded-full ml-2"
                    src="./assets/person.png"
                    alt="Avatar 2"
                  />
                </div>

                <div class="flex items-center mb-2">
                  <img
                    class="w-10 h-10 rounded-full mr-2"
                    src="./assets/person.png"
                    alt="Avatar 1"
                  />
                  <div class="text-sm text-gray-700">
                    <p class="poppins-medium">John Doe</p>
                    <div
                      class="bg-gray-50 rounded-es-full rounded-r-full px-4 py-2 shadow-md"
                    >
                      <p class="poppins-regular text-sm text-gray-900">
                        Hi i am John.
                      </p>
                    </div>
                  </div>
                </div>

                <div class="flex items-end justify-end mb-2">
                  <div class="text-sm text-gray-700 flex flex-col items-end">
                    <p class="poppins-medium">Abdelmalek Achkif</p>
                    <div
                      class="bg-green-400 rounded-ee-full rounded-l-full px-4 py-2 shadow-md"
                    >
                      <p class="poppins-regular text-sm text-gray-900">
                        Hi John How are you.
                      </p>
                    </div>
                  </div>
                  <img
                    class="w-10 h-10 rounded-full ml-2"
                    src="./assets/person.png"
                    alt="Avatar 2"
                  />
                </div>

                <div class="flex items-center mb-2">
                  <img
                    class="w-10 h-10 rounded-full mr-2"
                    src="./assets/person.png"
                    alt="Avatar 1"
                  />
                  <div class="text-sm text-gray-700">
                    <p class="poppins-medium">John Doe</p>
                    <div
                      class="bg-gray-50 rounded-es-full rounded-r-full px-4 py-2 shadow-md"
                    >
                      <p class="poppins-regular text-sm text-gray-900">
                        Hi i am John.
                      </p>
                    </div>
                  </div>
                </div>

                <div class="flex items-end justify-end mb-2">
                  <div class="text-sm text-gray-700 flex flex-col items-end">
                    <p class="poppins-medium">Abdelmalek Achkif</p>
                    <div
                      class="bg-green-400 rounded-ee-full rounded-l-full px-4 py-2 shadow-md"
                    >
                      <p class="poppins-regular text-sm text-gray-900">
                        Hi John How are you.
                      </p>
                    </div>
                  </div>
                  <img
                    class="w-10 h-10 rounded-full ml-2"
                    src="./assets/person.png"
                    alt="Avatar 2"
                  />
                </div>
              </div>

              <div
                *ngIf="userRoom.permission != 'VIEWER'"
                class="bg-gray-100 w-full"
              >
                <div class="flex items-center h-14 bg-white p-2 shadow-sm">
                  <textarea
                    rows="1"
                    class="w-full px-4 p-1 rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"
                  ></textarea>
                  <button class="text-blue-500 hover:text-blue-700 ml-4">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      class="h-6 w-6"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke="currentColor"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M14 5l7 7-7 7v-14z"
                      />
                    </svg>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div> -->
    </section>
  </section>
</main>
